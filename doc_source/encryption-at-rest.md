# Encryption at Rest<a name="encryption-at-rest"></a>

Data at rest is referred to as data saved to persistent media\. This page describes how encryption and decryption works for data at rest on an Amazon Managed Workflows for Apache Airflow \(MWAA\) environment\.

You can use an  [AWS owned key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#aws-owned-cmk) for data at rest encryption, or optionally provide a  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk) for additional encryption when you create an environment\. If you choose to use a  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk), it must be in the same account as the other AWS resources and services you are using for your environment\. 

We recommend using an  [AWS owned key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#aws-owned-cmk) out of ease of use for data encryption on your environment\.

Charges apply for the storage and use of an  [AWS owned key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#aws-owned-cmk) or  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk)\. For more information, see [AWS KMS Pricing](http://aws.amazon.com/kms/pricing/)\.

## How it works<a name="encryption-at-rest-tenants-how"></a>

If you do not specify a  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk) when creating your environment, Amazon MWAA uses its  [AWS owned key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#aws-owned-cmk) for data encryption on your environment\.

If you specify a  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk) when creating your Amazon MWAA environment, Amazon MWAA attaches four  [grants](https://docs.aws.amazon.com/kms/latest/developerguide/grants.html) on your behalf\. For more information on the  [grants](https://docs.aws.amazon.com/kms/latest/developerguide/grants.html) Amazon MWAA attaches to a  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk) on your behalf, see [Customer managed keys for Data Encryption](https://docs.aws.amazon.com/mwaa/latest/userguide/custom-keys-certs.html)\.

In addition, if you provide a  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk), you must attach the policy statement for CloudWatch access\. You must also create the  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk)\-specific execution role\.

## Encryption artifacts<a name="encryption-at-rest-services"></a>

You specify the encryption artifacts used for at\-rest encryption by specifying an  [AWS owned key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#aws-owned-cmk) or  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk) when you create your Amazon MWAA environment\. Amazon MWAA adds the  [grants](https://docs.aws.amazon.com/kms/latest/developerguide/grants.html) needed to your specified key\.

**Amazon S3** — Amazon S3 data is encrypted at the object\-level using Server\-Side Encryption \(SSE\)\. Amazon S3 encryption and decryption takes place on the Amazon S3 bucket where your DAG code and supporting files are stored\. Objects are encrypted when they are uploaded to Amazon S3 and decrypted when they are downloaded to your Amazon MWAA environment\. By default, if you are using a  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk), Amazon MWAA uses it to read and decrypt the data on your S3 bucket\.

**CloudWatch Logs** — If you are using an  [AWS owned key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#aws-owned-cmk), Apache Airflow logs sent to CloudWatch Logs are encrypted using Server\-Side Encryption \(SSE\) using CloudWatch Logs's  [AWS owned key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#aws-owned-cmk)\. If you are using a  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk), you must add a [key policy](https://docs.aws.amazon.com/kms/latest/developerguide/key-policies.html) to your  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk) to allow CloudWatch Logs to use your key\.

**Amazon SQS** — Amazon MWAA creates one SQS queue for your environment\. The encryption for a queue is handled using Server\-Side Encryption \(SSE\) with either an  [AWS owned key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#aws-owned-cmk), or a provided  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk)\. You must add SQS permissions to your execution role regardless of whether you are using an  [AWS owned key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#aws-owned-cmk), or a provided  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk)\.

**Aurora PostgreSQL** — Amazon MWAA creates one PostgreSQL cluster for your environment\. Aurora PostgreSQL encrypts the contents with either an  [AWS owned key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#aws-owned-cmk), or a provided  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk) using Server\-Side Encryption \(SSE\)\. If you are using a  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk), Amazon RDS adds at least two  [grants](https://docs.aws.amazon.com/kms/latest/developerguide/grants.html): one for the cluster and one for the database instance\. It may create additional grants if you choose to use your  [Customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk) on multiple environments\. For more information, see [Data protection in Amazon RDS](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/DataDurability.html)\.